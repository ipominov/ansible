---
- name: Prepare clear machine
  hosts: ubuntu
  
  tasks:

  - name: Disable Firewalld service
    systemd:
      name: firewalld
      enabled: no
      state: stopped
    when: ansible_facts['distribution'] == "CentOS"

  - name: Disable UFW service
    systemd:
      name: ufw
      enabled: no
      state: stopped
    when: ansible_facts['distribution'] == "Ubuntu"

  - name: Install EPEL-Release (if Centos)
    yum:
      name: epel-release
      state: present
    when: ansible_facts['distribution'] == "CentOS"

  - name: Upgrade all packages (if CentOS)
    yum:
      name: '*'
      state: latest
    when: ansible_facts['distribution'] == "CentOS"

  - name: Upgrade all packages (if Ubuntu)
    apt:
      pkg: '*'
      state: latest
    when: ansible_facts['distribution'] == "Ubuntu"  

  - name: Install needful soft
    yum:
      name: "{{ item }}"
      state: present
    loop:
      - htop
      - wget
      - nano
    when: ansible_facts['distribution'] == "CentOS"